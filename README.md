# 工数管理システム

## 概要
日々の業務内容（工数）とその作業時間を記録・管理するためのデスクトップアプリケーションです。

## ユーザーフロー

### 1. 業務の開始
1.  **アプリ起動**: アプリを起動した時刻を「業務開始時刻」として内部的に記録します。
2.  **メイン画面表示**: その日の工数を一覧で表示するメイン画面（画面2）が表示されます。
    -   前日までに記録のある工数がリストアップされます。
    -   過去に登録されたすべての工数（`tasks`テーブルの内容）がリストアップされます。

### 2. 工数の記録（タスクの開始から終了まで）
1.  **工数の選択**:
    -   **既存の工数**: リストから作業したい工数の「開始」ボタンをクリックします。
    -   **新規の工数**: リストにない工数の場合、「＋ 工数を追加」ボタンから工数名を登録し、その後「Start」ボタンをクリックします。
2.  **開始時刻の確認**:
    -   開始時刻の確認ポップアップ（画面4）が表示されます。
    -   現在時刻がデフォルトで入力されていますが、必要に応じて修正可能です。
    -   「Start」ボタンを押して次に進みます。
3.  **終了時刻の確認**:
    -   計測中のタスクの「End」ボタンをクリック、または行をダブルクリックします。
    -   終了時刻の確認ポップアップ（画面5）が表示されます。
    -   現在時刻がデフォルトで入力されていますが、必要に応じて修正可能です。
    -   「確定」ボタンを押します。
4.  **記録完了**:
    -   開始時刻と終了時刻が`time_logs`テーブルに記録されます。
    -   メイン画面（画面2）に戻り、該当工数の「合計業務時間」と「ログ」が更新されます。
    -   **表示更新の仕様**: 合計時間とログは、その日（`work_date`）の`time_logs`テーブルから都度計算して表示する。

### 3. 業務の終了
1.  **終了操作**: メイン画面（画面2）の「業務終了」ボタンをクリックします。
2.  **最終確認**: 確認ポップアップ（画面6）で「はい」を選択します。
3.  **結果表示とアプリ終了**:
    -   その日の「業務終了時刻」が記録されます。
    -   一日のサマリー画面（画面7）が表示されます。
        -   工数ごとの合計作業時間
        -   どの工数にも属さない「その他」の時間
    -   サマリー画面を閉じると、アプリケーションが終了します。

## 画面構成

*   **画面2 (メイン画面)**: 工数一覧と各種操作ボタンを配置。
*   **画面3 (工数追加ポップアップ)**: 新しい工数名を入力・登録する。
*   **画面4 (開始時刻確認ポップアップ)**: 作業開始時刻を確認・修正する。
*   **画面5 (終了時刻確認ポップアップ)**: 作業終了時刻を確認・修正する。
*   **画面6 (業務終了確認ポップアップ)**: 業務終了の意思を確認する。
*   **画面7 (リザルト画面)**: 一日の作業サマリーを表示する。

### メイン画面（画面2）のテーブルレイアウト案

| アクション | 工数名     | 合計時間 | ステータス | ログ                     |
| :--------- | :--------- | :------- | :--------- | :----------------------- |
| End        | メイン業務 | 2.5h     | 計測中...  | 11:00~11:30, 14:22~15:22 |
| Start      | サブ1      | 2.0h     |            | 10:00~11:00, 13:00~14:00 |
| Start      | サブ2      | 0.0h     |            |                          |

---

## 技術仕様・補足事項

### 機能仕様
-   **一時停止機能**: 現バージョンでは実装せず、「開始」と「終了」のみの操作とします。

### データベース
-   **種類**: SQLite
-   **役割**: 全ての工数名、日々の業務時間、個々の作業ログを永続的に保存します。

### データ復旧
-   **一時ファイル**: アプリが予期せず終了した場合に備え、現在の作業状態（計測中のタスクID、開始時刻、記録したログIDなど）をJSON形式のファイル（例: `session.json`）に保存します。
-   **復元処理**: 次回アプリ起動時に一時ファイルが存在する場合、その内容を読み込んで作業状態を復元します。
-   **保存タイミング**: タスク開始時、タスク終了時、およびアプリの正常終了時に一時ファイルを更新・削除する。

### 時間計算
-   **その他時間**: 以下の計算式で算出します。
    -   `業務終了時刻 - 業務開始時刻 - 全工数の合計作業時間 - 休憩時間`
-   **休憩時間**: デフォルト値を1時間とします。将来的には設定画面で変更可能にすることを想定します。

### データベース設計案

#### `work_days` テーブル (日ごとの業務記録)
- `id` (INTEGER, PRIMARY KEY): 識別子
- `work_date` (TEXT, UNIQUE): 対象日 (例: '2023-10-27')
- `start_time` (TEXT): その日の業務開始時刻 (ISO 8601形式)
- `end_time` (TEXT): その日の業務終了時刻 (ISO 8601形式)

#### `tasks` テーブル (工数マスタ)
- `id` (INTEGER, PRIMARY KEY): 識別子
- `task_name` (TEXT, UNIQUE): 工数名 (例: 'メイン業務')

#### `time_logs` テーブル (時間ログ)
- `id` (INTEGER, PRIMARY KEY): 識別子
- `work_day_id` (INTEGER): `work_days.id`への外部キー
- `task_id` (INTEGER): `tasks.id`への外部キー
- `start_time` (TEXT): 作業開始時刻 (ISO 8601形式)
- `end_time` (TEXT): 作業終了時刻 (ISO 8601形式)
